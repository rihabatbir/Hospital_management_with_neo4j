<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Analyse Médicale</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8 min-h-screen">
  <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">📊 Analyse des Données Médicales</h1>

  <div class="grid gap-8 max-w-6xl mx-auto">

    <!-- Médecins par pathologie -->
    <section>
      <h2 class="text-xl font-semibold mb-2 text-gray-800">👨‍⚕️ Médecins les plus associés par pathologie</h2>
      <table class="w-full bg-white rounded shadow">
        <thead class="bg-indigo-600 text-white">
          <tr><th class="p-2">Pathologie</th><th class="p-2">Médecin</th><th class="p-2">Occurrences</th></tr>
        </thead>
        <tbody id="table-medecins" class="divide-y"></tbody>
      </table>
    </section>

    <!-- Nombre de diagnostics par pathologie -->
    <section>
      <h2 class="text-xl font-semibold mb-2 text-gray-800">📋 Nombre de diagnostics par pathologie</h2>
      <table class="w-full bg-white rounded shadow">
        <thead class="bg-green-600 text-white">
          <tr><th class="p-2">Pathologie</th><th class="p-2">Total</th></tr>
        </thead>
        <tbody id="table-diagnostics" class="divide-y"></tbody>
      </table>
    </section>

    <!-- Traitements les plus prescrits -->
    <section>
      <h2 class="text-xl font-semibold mb-2 text-gray-800">💊 Traitements les plus prescrits</h2>
      <table class="w-full bg-white rounded shadow">
        <thead class="bg-purple-600 text-white">
          <tr><th class="p-2">Traitement</th><th class="p-2">Nb prescriptions</th></tr>
        </thead>
        <tbody id="table-traitements" class="divide-y"></tbody>
      </table>
    </section>

  </div>

  <script>
    async function fetchData(url, target) {
      const res = await fetch(url);
      const data = await res.json();
      const tbody = document.getElementById(target);
      tbody.innerHTML = "";
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = Object.values(row).map(val =>
          `<td class="p-2">${val}</td>`
        ).join("");
        tbody.appendChild(tr);
      });
    }

    fetchData("http://localhost:3000/analyse/medecins-pathologies", "table-medecins");
    fetchData("http://localhost:3000/analyse/diagnostics-par-pathologie", "table-diagnostics");
    fetchData("http://localhost:3000/analyse/traitements-populaires", "table-traitements");
  </script>
</body>
</html>
